---
const { title } = Astro.props;
---
<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>{title}</title>
    <!-- TEMP: remove global.css while debugging -->
    <style>
      :root { --brand:#003366; }
      * { box-sizing: border-box; }
      html, body { margin:0; font-family: system-ui, -apple-system, Segoe UI, Roboto, "Helvetica Neue", Arial, "Noto Sans"; }
      body { color:#111 !important; background:#fff; }

      /* NAV */
      nav { background: var(--brand); color:#fff; position: sticky; top:0; z-index:50; }
      .nav-container { max-width:1200px; margin:0 auto; padding:.75rem 1rem; display:flex; align-items:center; justify-content:space-between; gap:1rem; }
      .brand a { color:#fff; text-decoration:none; font-weight:700; letter-spacing:.3px; }

      .links { display:none; align-items:center; gap:.25rem; }
      .links > li { list-style:none; position:relative; }
      .link, .menu-button { display:inline-flex; align-items:center; gap:.35rem; color:#fff; text-decoration:none; font-weight:500; padding:.5rem .65rem; border-radius:.5rem; }
      .link:hover, .menu-button:hover { background: rgba(255,255,255,.12); }
      .caret { display:inline-block; transition: transform .2s ease; }
      .menu-button[aria-expanded="true"] .caret { transform: rotate(180deg); }

      .menu { position:absolute; left:0; top:calc(100% + .25rem); background:#fff; color:#111; min-width:220px; border-radius:.75rem; padding:.35rem; box-shadow:0 10px 25px rgba(0,0,0,.18); display:none; }
      .menu a { display:block; padding:.5rem .65rem; border-radius:.5rem; color:#111; text-decoration:none; font-weight:500; }
      .menu a:hover { background:#f3f4f6; }
      @media (hover:hover) { .links > li:focus-within .menu, .links > li:hover .menu { display:block; } }

      .mobile-toggle { display:inline-flex; align-items:center; justify-content:center; width:40px; height:40px; border:1px solid rgba(255,255,255,.35); border-radius:.65rem; background:transparent; color:#fff; }
      .mobile-panel { position:fixed; inset:0; background:rgba(0,0,0,.4); z-index:40; display:none; }
      .mobile-sheet { position:absolute; right:0; top:0; height:100%; width:min(92vw,360px); background:#fff; color:#111; padding:1rem; overflow:auto; box-shadow:-10px 0 25px rgba(0,0,0,.25); }
      .mobile-panel[data-open="true"] { display:block; }

      /* PAGE CONTENT — FORCE VISIBLE */
      main { max-width:1200px; margin:1.25rem auto; padding:0 1rem 3rem; min-height:60vh;
             display:block !important; visibility:visible !important; }
      .page-container, section { display:block !important; visibility:visible !important; }
      .debug { padding:12px; margin:8px 0; border:2px dashed #e11; background:#fee; color:#900; font-weight:700; }

      footer { background:#0b2d5a; color:#cbd5e1; padding:2rem 1rem; }
      footer a { color:#fff; }
      @media (min-width:980px){ .mobile-toggle{display:none;} .links{display:flex;} }
    </style>
  </head>
  <body>
    <nav>
      <div class="nav-container">
        <div class="brand"><a href="/">A.R.A.I.</a></div>
        <ul class="links" role="menubar" aria-label="Primary">
          <li><a class="link" href="/">Home</a></li>
          <li><a class="link" href="/about/">About</a></li>
          <li><a class="link" href="/research/">Research</a></li>
          <li>
            <button class="menu-button" aria-expanded="false" aria-haspopup="true" aria-controls="testimonials-menu">
              Testimonials <span class="caret">▾</span>
            </button>
            <div id="testimonials-menu" class="menu" role="menu">
              <a role="menuitem" href="/testimonials/clients/">Client Stories</a>
              <a role="menuitem" href="/testimonials/practitioners/">Practitioner Feedback</a>
            </div>
          </li>
          <li><a class="link" href="/protocols/">Protocols</a></li>
          <li><a class="link" href="/health-help/">Health Help</a></li>
          <li><a class="link" href="/international-help/">International Help</a></li>
          <li><a class="link" href="/contact/">Contact</a></li>
        </ul>
        <button id="hamburger" class="mobile-toggle" aria-expanded="false" aria-controls="mobilePanel" aria-label="Open menu">☰</button>
      </div>
    </nav>

    <div id="mobilePanel" class="mobile-panel" data-open="false" aria-hidden="true">
      <div class="mobile-sheet" role="dialog" aria-modal="true" aria-label="Mobile menu">
        <div class="nav-container" style="padding:0;justify-content:space-between;">
          <strong>Menu</strong>
          <button id="closeMobile" class="mobile-toggle" aria-label="Close menu">✕</button>
        </div>
      </div>
    </div>

    <main>
      <div class="debug">DEBUG: Layout slot below. If your page content doesn’t appear, it’s not reaching the slot.</div>
      <slot />
    </main>

    <footer>
      <div class="nav-container" style="justify-content:space-between;">
        <div>© {new Date().getFullYear()} A.R.A.I.</div>
        <div><a href="/privacy/">Privacy</a> · <a href="/terms/">Terms</a></div>
      </div>
    </footer>

    <script>
      (function () {
        const menuButton = document.querySelector('.menu-button');
        const menu = document.getElementById('testimonials-menu');
        if (menuButton && menu) {
          menuButton.addEventListener('click', (e) => {
            const open = menuButton.getAttribute('aria-expanded') === 'true';
            menuButton.setAttribute('aria-expanded', String(!open));
            menu.style.display = open ? 'none' : 'block';
            e.stopPropagation();
          });
          document.addEventListener('click', (e) => {
            if (!menu.contains(e.target) && e.target !== menuButton) {
              menuButton.setAttribute('aria-expanded', 'false');
              menu.style.display = 'none';
            }
          });
        }
        const hamburger = document.getElementById('hamburger');
        const panel = document.getElementById('mobilePanel');
        const closeBtn = document.getElementById('closeMobile');
        const openPanel = () => { panel.dataset.open='true'; panel.setAttribute('aria-hidden','false'); hamburger.setAttribute('aria-expanded','true'); document.documentElement.style.overflow='hidden'; };
        const closePanel = () => { panel.dataset.open='false'; panel.setAttribute('aria-hidden','true'); hamburger.setAttribute('aria-expanded','false'); document.documentElement.style.overflow=''; };
        hamburger?.addEventListener('click', openPanel);
        closeBtn?.addEventListener('click', closePanel);
        panel?.addEventListener('click', (e) => { if (e.target === panel) closePanel(); });
        window.addEventListener('pageshow', () => { closePanel(); });
        // Log whether slot has children:
        setTimeout(() => {
          const m = document.querySelector('main');
          console.log('DEBUG slot content length:', m?.innerText?.trim().length);
        }, 0);
      })();
    </script>
  </body>
</html>
