---
const { title = "Site" } = Astro.props;
---
<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>{title}</title>

    <link rel="stylesheet" href="/styles/global.css" />

    <style>
      :root { --nav-h: 64px; }
      * { box-sizing: border-box; }
      body { margin:0; font-family: system-ui, sans-serif; background:#f5f7fb; color:#111; }

      /* Top nav */
      nav { position: fixed; top:0; left:0; right:0; height: var(--nav-h); background:#003366; display:flex; align-items:center; z-index:1000; }
      .nav-container { max-width:1200px; margin:0 auto; width:100%; padding:0 16px; display:flex; align-items:center; gap:16px; }
      .brand a { color:#fff; text-decoration:none; font-weight:700; letter-spacing:.5px; }
      .links { list-style:none; margin:0; padding:0; display:flex; gap:10px; align-items:center; }
      .links > li { position:relative; }
      .link, .menu-button { color:#fff; text-decoration:none; padding:8px 10px; font: inherit; background:none; border:0; cursor:pointer; }
      .link:hover, .menu-button:hover { text-decoration: underline; }

      /* Dropdown menu (Testimonials) */
      .menu { position:absolute; top:100%; left:0; background:#fff; color:#111; border:1px solid #ddd; border-radius:8px; padding:6px; min-width:220px; box-shadow:0 8px 24px rgba(0,0,0,.12); display:none; z-index:1001; }
      .menu a { display:block; padding:8px 10px; color:#111; text-decoration:none; border-radius:6px; }
      .menu a:hover { background:#f0f3f8; }

      /* Mobile */
      .mobile-toggle { margin-left:auto; color:#fff; background:none; border:0; font-size:22px; line-height:1; display:none; cursor:pointer; }
      @media (max-width: 840px) {
        .links { display:none; }
        .mobile-toggle { display:block; }
      }

      /* Mobile panel (fixed sheet) */
      .mobile-panel {
        position: fixed; inset: 0; background: rgba(0,0,0,.35);
        display:none; pointer-events:none; opacity:0;
        z-index: 1100;
      }
      .mobile-panel[data-open="true"] { display:block; pointer-events:auto; opacity:1; }
      .mobile-sheet {
        background:#fff; width:min(92vw, 420px); height:100%;
        margin-left:auto; padding:18px;
        box-shadow: -8px 0 24px rgba(0,0,0,.2);
      }

      main {
        padding-top: calc(var(--nav-h) + 16px);
        max-width:1200px; margin:0 auto;
        padding-left:16px; padding-right:16px;
        min-height: 60vh; outline: 2px dashed #9aa; /* diagnostic */
      }

      footer { padding:24px 0; }
      footer a { color:#003366; text-decoration:none; }
      footer a:hover { text-decoration:underline; }
    </style>
  </head>
  <body>
    <nav>
      <div class="nav-container">
        <div class="brand"><a href="/">A.R.A.I.</a></div>
        <ul class="links" role="menubar" aria-label="Primary">
          <li><a class="link" href="/">Home</a></li>
          <li><a class="link" href="/about/">About</a></li>
          <li><a class="link" href="/research/">Research</a></li>

          <li>
            <button class="menu-button" aria-expanded="false" aria-haspopup="true" aria-controls="testimonials-menu">
              Testimonials <span class="caret">▾</span>
            </button>
            <div id="testimonials-menu" class="menu" role="menu" aria-hidden="true">
              <a role="menuitem" href="/testimonials/clients/">Client Stories</a>
              <a role="menuitem" href="/testimonials/practitioners/">Practitioner Feedback</a>
            </div>
          </li>

          <li><a class="link" href="/protocols/">Protocols</a></li>
          <li><a class="link" href="/health-help/">Health Help</a></li>
          <li><a class="link" href="/international-help/">International Help</a></li>
          <li><a class="link" href="/contact/">Contact</a></li>
        </ul>

        <button id="hamburger" class="mobile-toggle" aria-expanded="false" aria-controls="mobilePanel" aria-label="Open menu">☰</button>
      </div>
    </nav>

    <div id="mobilePanel" class="mobile-panel" data-open="false" aria-hidden="true">
      <div class="mobile-sheet" role="dialog" aria-modal="true" aria-label="Mobile menu">
        <div class="nav-container" style="padding:0; justify-content:space-between;">
          <strong>Menu</strong>
          <button id="closeMobile" class="mobile-toggle" aria-label="Close menu">✕</button>
        </div>
        <!-- Add mobile links if you want them now -->
      </div>
    </div>

    <main>
      
      <slot />
    </main>

    <footer>
      <div class="nav-container" style="justify-content:space-between;">
        <div>© {new Date().getFullYear()} A.R.A.I.</div>
        <div><a href="/privacy/">Privacy</a> · <a href="/terms/">Terms</a></div>
      </div>
    </footer>

    <script>
      (function () {
        // Dropdown
        const menuButton = document.querySelector('.menu-button');
        const menu = document.getElementById('testimonials-menu');
        if (menuButton && menu) {
          const closeMenu = () => {
            menuButton.setAttribute('aria-expanded', 'false');
            menu.setAttribute('aria-hidden', 'true');
            menu.style.display = 'none';
          };
          const openMenu = () => {
            menuButton.setAttribute('aria-expanded', 'true');
            menu.setAttribute('aria-hidden', 'false');
            menu.style.display = 'block';
          };

          menuButton.addEventListener('click', (e) => {
            const open = menuButton.getAttribute('aria-expanded') === 'true';
            open ? closeMenu() : openMenu();
            e.stopPropagation();
          });
          document.addEventListener('click', (e) => {
            if (!menu.contains(e.target) && e.target !== menuButton) closeMenu();
          });
        }

        // Mobile panel — use data-open to match CSS
        const hamburger = document.getElementById('hamburger');
        const panel = document.getElementById('mobilePanel');
        const closeBtn = document.getElementById('closeMobile');
        const openPanel = () => { panel.dataset.open='true'; panel.setAttribute('aria-hidden','false'); hamburger.setAttribute('aria-expanded','true'); document.documentElement.style.overflow='hidden'; };
        const closePanel = () => { panel.dataset.open='false'; panel.setAttribute('aria-hidden','true'); hamburger.setAttribute('aria-expanded','false'); document.documentElement.style.overflow=''; };
        hamburger?.addEventListener('click', openPanel);
        closeBtn?.addEventListener('click', closePanel);
        panel?.addEventListener('click', (e) => { if (e.target === panel) closePanel(); });
        window.addEventListener('pageshow', () => { closePanel(); });

        // Log whether slot has children:
        setTimeout(() => {
          const m = document.querySelector('main');
          console.log('DEBUG slot content length:', m?.innerText?.trim().length);
        }, 0);
      })();
    </script>
  </body>
</html>
